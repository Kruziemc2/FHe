<!DOCTYPE html>
<footer>
    <p>© 2025 <strong>Kru Su</strong> | 赫爾斯盾場研究創建者</p>
</footer>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>赫爾斯盾場 數據分析</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #ffffff;
            text-align: center;
        }
        h1 {
            color: #FFD700;
        }
        .data-section {
            margin: 20px;
            padding: 10px;
            border-radius: 10px;
            background-color: #1e1e1e;
        }
        .data-item {
            font-size: 18px;
            margin: 10px 0;
        }
        .chart-container {
            width: 80%;
            margin: auto;
        }
    </style>
    <script>
        async function fetchData() {
                const API_KEY ="UlxbY1TIgdhFZkW4FgeIcrOa3Ttb4TVYU4W3nV3S"; // 在這裡替換為你的 API Key
            const API_URL = "https://api.solarsystemdata.com/v1/solarwind";

            try {
                const response = await fetch(API_URL, {
                    headers: { "Authorization": `Bearer ${UlxbY1TIgdhFZkW4FgeIcrOa3Ttb4TVYU4W3nV3S}` }
                });
                const data = await response.json();

                document.getElementById("solarwind").innerHTML = `🌞 太陽風速度: ${data.velocity} km/s`;
                document.getElementById("magnetic").innerHTML = `🧲 磁場強度: ${data.magnetic} nT`;
                document.getElementById("density").innerHTML = `🌌 粒子密度: ${data.density} cm³`;
                document.getElementById("radiation").innerHTML = `☢ 高能粒子輻射: ${data.sep_flux} flux`;

                // 更新數據歷史
                updateHistory(data);
            } catch (error) {
                console.error("獲取數據失敗", error);
            }
        }

        let historyData = [];

        function updateHistory(newData) {
            if (historyData.length >= 5) historyData.shift();
            historyData.push({
                time: new Date().toLocaleTimeString(),
                velocity: newData.velocity,
                magnetic: newData.magnetic,
                density: newData.density,
                radiation: newData.sep_flux
            });

            let historyHTML = "<h3>📜 過去數據</h3><ul>";
            historyData.forEach(entry => {
                historyHTML += `<li>${entry.time} | 風速: ${entry.velocity} km/s | 磁場: ${entry.magnetic} nT | 密度: ${entry.density} cm³ | 輻射: ${entry.radiation} flux</li>`;
            });
            historyHTML += "</ul>";
            document.getElementById("history").innerHTML = historyHTML;
        }

        setInterval(fetchData, 5000); // 每 5 秒更新一次數據
    </script>
</head>
<body onload="fetchData()">
    <h1>赫爾斯盾場 數據分析</h1>
    <p>此頁面顯示來自 Solar System API 的**即時數據**。</p>

    <div class="data-section">
        <h2>📡 即時數據</h2>
        <p class="data-item" id="solarwind">載入中...</p>
        <p class="data-item" id="magnetic">載入中...</p>
        <p class="data-item" id="density">載入中...</p>
        <p class="data-item" id="radiation">載入中...</p>
    </div>

    <div class="data-section" id="history">
        <h2>📜 過去數據</h2>
        <p>數據即將顯示...</p>
    </div>

    <div class="chart-container">
        <h2>📊 數據趨勢</h2>
        <canvas id="dataChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let chartData = {
            labels: [],
            datasets: [{
                label: '太陽風速度 (km/s)',
                borderColor: 'rgba(255, 99, 132, 1)',
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                data: []
            }]
        };

        let ctx = document.getElementById("dataChart").getContext("2d");
        let dataChart = new Chart(ctx, {
            type: "line",
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: false }
                }
            }
        });

        function updateChart(newData) {
            if (chartData.labels.length >= 10) {
                chartData.labels.shift();
                chartData.datasets[0].data.shift();
            }
            chartData.labels.push(new Date().toLocaleTimeString());
            chartData.datasets[0].data.push(newData.velocity);

            dataChart.update();
        }

        setInterval(() => {
            fetch("https://api.solarsystemdata.com/v1/solarwind", {
                headers: { "Authorization": "Bearer UlxbY1TIgdhFZkW4FgeIcrOa3Ttb4TVYU4W3nV3S" }
            })
            .then(response => response.json())
            .then(data => {
                updateChart(data);
            })
            .catch(error => console.error("無法獲取新數據", error));
        }, 5000);
    </script>
</body>
</html>
